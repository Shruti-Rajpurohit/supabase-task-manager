<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase Task Manager</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .auth-container, .app-container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        input[type="email"],
        input[type="password"],
        input[type="text"] {
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 15px;
            transition: border-color 0.3s;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        button:hover {
            background: #5568d3;
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .secondary-btn {
            background: transparent;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .secondary-btn:hover {
            background: #f5f7ff;
        }

        .message {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .error {
            background: #fee;
            color: #c33;
            border: 1px solid #fcc;
        }

        .success {
            background: #efe;
            color: #3c3;
            border: 1px solid #cfc;
        }

        .task-input-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .task-input-container input {
            flex: 1;
        }

        .tasks-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .task-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            gap: 12px;
            transition: background 0.2s;
        }

        .task-item:hover {
            background: #e9ecef;
        }

        .task-item.completed {
            opacity: 0.6;
        }

        .task-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .task-title {
            flex: 1;
            font-size: 15px;
            color: #333;
        }

        .task-item.completed .task-title {
            text-decoration: line-through;
            color: #999;
        }

        .delete-btn {
            padding: 8px 16px;
            background: #dc3545;
            font-size: 13px;
        }

        .delete-btn:hover {
            background: #c82333;
        }

        .user-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .user-email {
            color: #666;
            font-size: 14px;
        }

        .logout-btn {
            padding: 8px 16px;
            background: #6c757d;
            font-size: 13px;
        }

        .logout-btn:hover {
            background: #5a6268;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }

        .hidden {
            display: none;
        }

        .toggle-auth {
            text-align: center;
            margin-top: 15px;
            color: #666;
            font-size: 14px;
        }

        .toggle-auth a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }

        .toggle-auth a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Authentication Container -->
        <div id="authContainer" class="auth-container">
            <h1>Supabase Task Manager</h1>
            <p class="subtitle">Sign up or log in to get started</p>
            
            <div id="message"></div>
            
            <form id="authForm" class="auth-form">
                <input type="email" id="email" placeholder="Email" required>
                <input type="password" id="password" placeholder="Password" required>
                <button type="submit" id="authButton">Sign Up</button>
            </form>
            
            <div class="toggle-auth">
                <span id="toggleText">Already have an account? <a href="#" id="toggleLink">Log In</a></span>
            </div>
        </div>

        <!-- App Container -->
        <div id="appContainer" class="app-container hidden">
            <div class="user-info">
                <div>
                    <h1>My Tasks</h1>
                    <p class="user-email" id="userEmail"></p>
                </div>
                <button class="logout-btn" id="logoutBtn">Log Out</button>
            </div>

            <div class="task-input-container">
                <input type="text" id="taskInput" placeholder="What needs to be done?">
                <button id="addTaskBtn">Add Task</button>
            </div>

            <div id="tasksList" class="tasks-list"></div>
            <div id="emptyState" class="empty-state hidden">
                <p>No tasks yet. Add one above to get started!</p>
            </div>
        </div>
    </div>

    <script>
        // ⚠️ REPLACE THESE WITH YOUR ACTUAL VALUES FROM SUPABASE DASHBOARD
        const SUPABASE_URL = 'https://cjcyajxtlcqrdkvkyhez.supabase.co'
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNqY3lhanh0bGNxcmRrdmt5aGV6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE3Njc5MzQsImV4cCI6MjA4NzM0MzkzNH0.CGJkGoI5mg_CILfR77Zpi1mRj_QWk-j5pH2LByYVMxI'

        // Initialize Supabase client
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY)

        // DOM elements
        const authContainer = document.getElementById('authContainer')
        const appContainer = document.getElementById('appContainer')
        const authForm = document.getElementById('authForm')
        const authButton = document.getElementById('authButton')
        const toggleLink = document.getElementById('toggleLink')
        const toggleText = document.getElementById('toggleText')
        const messageDiv = document.getElementById('message')
        const userEmail = document.getElementById('userEmail')
        const logoutBtn = document.getElementById('logoutBtn')
        const taskInput = document.getElementById('taskInput')
        const addTaskBtn = document.getElementById('addTaskBtn')
        const tasksList = document.getElementById('tasksList')
        const emptyState = document.getElementById('emptyState')

        let isSignUp = true

        // Check if user is already logged in
        supabase.auth.getSession().then(({ data: { session } }) => {
            if (session) {
                showApp(session.user)
            }
        })

        // Toggle between sign up and log in
        toggleLink.addEventListener('click', (e) => {
            e.preventDefault()
            isSignUp = !isSignUp
            authButton.textContent = isSignUp ? 'Sign Up' : 'Log In'
            toggleText.innerHTML = isSignUp 
                ? 'Already have an account? <a href="#" id="toggleLink">Log In</a>'
                : 'Need an account? <a href="#" id="toggleLink">Sign Up</a>'
            // Re-attach event listener to the new link
            document.getElementById('toggleLink').addEventListener('click', arguments.callee)
            messageDiv.innerHTML = ''
        })

        // Handle authentication
        authForm.addEventListener('submit', async (e) => {
            e.preventDefault()
            const email = document.getElementById('email').value
            const password = document.getElementById('password').value

            authButton.disabled = true
            authButton.textContent = 'Processing...'

            try {
                if (isSignUp) {
                    const { data, error } = await supabase.auth.signUp({ email, password })
                    if (error) throw error
                    showMessage('Check your email for confirmation link!', 'success')
                    authButton.textContent = 'Sign Up'
                } else {
                    const { data, error } = await supabase.auth.signInWithPassword({ email, password })
                    if (error) throw error
                    showApp(data.user)
                }
            } catch (error) {
                showMessage(error.message, 'error')
                authButton.textContent = isSignUp ? 'Sign Up' : 'Log In'
            } finally {
                authButton.disabled = false
            }
        })

        // Show app after successful login
        function showApp(user) {
            authContainer.classList.add('hidden')
            appContainer.classList.remove('hidden')
            userEmail.textContent = user.email
            loadTasks()
        }

        // Show auth screen
        function showAuth() {
            authContainer.classList.remove('hidden')
            appContainer.classList.add('hidden')
        }

        // Show message
        function showMessage(text, type) {
            messageDiv.innerHTML = `<div class="message ${type}">${text}</div>`
            setTimeout(() => {
                messageDiv.innerHTML = ''
            }, 5000)
        }

        // Logout
        logoutBtn.addEventListener('click', async () => {
            await supabase.auth.signOut()
            showAuth()
        })

        // Add task
        addTaskBtn.addEventListener('click', async () => {
            const title = taskInput.value.trim()
            if (!title) return

            addTaskBtn.disabled = true
            addTaskBtn.textContent = 'Adding...'

            try {
                const { data: { user } } = await supabase.auth.getUser()
                const { data, error } = await supabase
                    .from('tasks')
                    .insert([{ title, user_id: user.id }])
                    .select()

                if (error) throw error

                taskInput.value = ''
                loadTasks()
            } catch (error) {
                alert('Error adding task: ' + error.message)
            } finally {
                addTaskBtn.disabled = false
                addTaskBtn.textContent = 'Add Task'
            }
        })

        // Allow Enter key to add task
        taskInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addTaskBtn.click()
            }
        })

        // Load tasks
        async function loadTasks() {
            try {
                const { data: tasks, error } = await supabase
                    .from('tasks')
                    .select('*')
                    .order('created_at', { ascending: false })

                if (error) throw error

                if (tasks.length === 0) {
                    tasksList.innerHTML = ''
                    emptyState.classList.remove('hidden')
                } else {
                    emptyState.classList.add('hidden')
                    renderTasks(tasks)
                }
            } catch (error) {
                alert('Error loading tasks: ' + error.message)
            }
        }

        // Render tasks
        function renderTasks(tasks) {
            tasksList.innerHTML = tasks.map(task => `
                <div class="task-item ${task.is_complete ? 'completed' : ''}">
                    <input 
                        type="checkbox" 
                        class="task-checkbox" 
                        ${task.is_complete ? 'checked' : ''}
                        onchange="toggleTask(${task.id}, ${!task.is_complete})"
                    >
                    <span class="task-title">${task.title}</span>
                    <button class="delete-btn" onclick="deleteTask(${task.id})">Delete</button>
                </div>
            `).join('')
        }

        // Toggle task completion
        window.toggleTask = async (id, isComplete) => {
            try {
                const { error } = await supabase
                    .from('tasks')
                    .update({ is_complete: isComplete })
                    .eq('id', id)

                if (error) throw error
                loadTasks()
            } catch (error) {
                alert('Error updating task: ' + error.message)
            }
        }

        // Delete task
        window.deleteTask = async (id) => {
            if (!confirm('Delete this task?')) return

            try {
                const { error } = await supabase
                    .from('tasks')
                    .delete()
                    .eq('id', id)

                if (error) throw error
                loadTasks()
            } catch (error) {
                alert('Error deleting task: ' + error.message)
            }
        }
    </script>
</body>
</html>